fileVersion: 1
id: 3a62bd55-d782-483b-8e78-da5b087b8cf8
name: STG_BOOKINGS_TJ_SERVICE
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: RMH_SQL_SERVER_SERVICE_STG
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 60762d60-3736-4ce4-aef5-78e6999247a0
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: TRANS_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'Service Order'"
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: efc79249-b41e-4ab8-9d8d-b3a40926f2da
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: YEAR("STG_WO"."WO_DATE")
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: c03a68a7-6d8c-4933-9190-ac75b91d62cd
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: PRD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: MONTH("STG_WO"."WO_DATE")
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: c98b49ed-8640-45a4-a3a0-70a7c3fbfb02
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: ORDER_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: LEFT("STG_WO"."FIELD_8", 9)
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 4001e1d3-5828-456b-a3df-52c5c19f91b4
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: SALE_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |
              -SUM(
              CASE
                  WHEN "STG_UOM"."UNIT" = '100' THEN ((("STG_WO_LINE"."QTY_OPEN_ORD" + "STG_WO_LINE"."QTYINVOICE") / CAST(100 AS NUMERIC(10, 2))) * "STG_WO_LINE"."NET_PRICE")
                  ELSE (("STG_WO_LINE"."QTY_OPEN_ORD" + "STG_WO_LINE"."QTYINVOICE") * "STG_WO_LINE"."NET_PRICE")
              END)
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: f4a2cdef-1f2b-4794-a031-c34557c32191
          stepCounter: 3a62bd55-d782-483b-8e78-da5b087b8cf8
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: ORDER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3a967bbd-7058-4eb8-b866-e7ac1bebe212
                stepCounter: af53fc6c-dbe9-49dc-a793-5a3298e9d4cb
            transform: ""
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_ITEM: cad668ae-9b21-4063-b9da-af244d04642b
          STG_PR_GROUP: ff14b386-d96c-4cb6-ac64-244703e4ef8e
          STG_UOM: 85deb06d-fa39-4a43-886a-872cc4b5d22d
          STG_WO: af53fc6c-dbe9-49dc-a793-5a3298e9d4cb
          STG_WO_LINE: 33d04688-3617-4570-807e-a1177c01ea91
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_ITEM
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_PR_GROUP
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_UOM
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_WO
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_WO_LINE
        join:
          joinCondition: |
            FROM {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_WO_LINE') }} "STG_WO_LINE"
            INNER JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_WO') }} "STG_WO"
            ON "STG_WO_LINE"."WO_NO" = "STG_WO"."WO_NO"
            LEFT JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_ITEM') }} "STG_ITEM"
            ON "STG_WO_LINE"."ITEM_NO" = "STG_ITEM"."ITEM_NO"
            LEFT JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_PR_GROUP') }} "STG_PR_GROUP"
            ON "STG_ITEM"."PROD_GROUP" = "STG_PR_GROUP"."PROD_GROUP"
            INNER JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_UOM') }} "STG_UOM"
            ON "STG_WO_LINE"."UOM_CODE" = "STG_UOM"."UOM_CODE"

            WHERE SUBSTRING("STG_WO"."FIELD_8",3,1) IN ('-')
            GROUP BY "STG_WO_LINE"."WO_NO", "STG_WO"."FIELD_1", "STG_WO"."FIELD_8", "STG_WO"."WO_DATE"
        name: STG_BOOKINGS_TJ_SERVICE
        noLinkRefs: []
  name: STG_BOOKINGS_TJ_SERVICE
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
