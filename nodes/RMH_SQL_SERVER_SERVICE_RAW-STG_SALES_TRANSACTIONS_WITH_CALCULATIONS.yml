fileVersion: 1
id: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
name: STG_SALES_TRANSACTIONS_WITH_CALCULATIONS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: RMH_SQL_SERVER_SERVICE_RAW
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79b72ec8-6fc7-4646-92b1-1b8d5266b02c
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: ORDER_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 79dc3767-a476-4e44-a498-060869cf0ab0
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 56cdc783-8430-4154-9d68-3527e299a574
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(16)
        description: ""
        name: JOB_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: afe61ddd-3f20-417b-ab90-b57eeb150b32
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e1ecbc6-27d4-40df-9793-2088543e2043
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(32)
        description: ""
        name: ITEM_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: eaf65ef6-3241-48a6-af7b-b545a61bd7dd
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f5f2b117-673f-4788-a94e-10e943b0c057
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(8)
        description: ""
        name: PROD_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bef94c19-2ba6-4448-9ff3-4fe11b4104f1
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c7e0288b-3c33-4245-9983-537924d17427
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(16)
        description: ""
        name: CUST_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 007a5eef-11f6-4794-bf7c-13ef5e7270c0
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fb4f18b9-d74a-4857-ae7c-4c3d175aa1b3
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(100)
        description: ""
        name: SHIP_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 40373d12-41fc-4725-9c2f-5de146b3f621
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d9df0204-7bc1-4d60-ab8b-bc4e2df0d617
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: SEQ_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 78267022-ee44-423f-a963-3432ad9fc507
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2efab453-8828-4ef9-b343-e34fbf3e07db
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: QTY_SHIPPED
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4fd0ad2e-96d7-43d1-8fdb-d2f4e841cde2
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 205f13f6-f278-436f-9446-ff52a8430397
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(19,4)
        description: ""
        name: NET_PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5b7c1b6a-751e-41ab-a4ff-6b6cf7fa0a1b
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f581c1a-9017-4fcd-a6d9-cc161d8f510b
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: GROSS_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fe0668d7-c1f7-49fa-b948-d726a27f760f
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2f2c5308-9948-4fe0-a4c4-b3e8c1273517
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(17,4)
        description: ""
        name: COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2ffc731e-6456-4f3d-ae13-70a2bee166c8
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82e0fbef-2cd5-4baa-b31c-4952ee95b182
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(40)
        description: ""
        name: FIELD_7
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 806eed2f-f8a8-48fc-8075-cbe5caa3e124
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c9829558-61cf-47fa-948d-3019a7c4c2fd
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: ORDER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 11f386a3-57be-47a4-b2ff-71bf38cde880
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fab299f6-a210-47cb-ac71-121d0d1c5bd1
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: YR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb547cda-d79d-40a3-a524-0681e7b31584
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f80178b0-2048-4993-bc49-477ed7cd5ffd
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: PRD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 95b247a1-00b5-4f3c-8237-e41f7f0e4083
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 20023c62-8f10-495c-bac4-e5cfc7097c44
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(16)
        description: ""
        name: DOCUMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d65f311c-437c-425e-918c-d912f27fd7e1
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7e90d40e-c5ab-497b-a0fa-738ebabc4d75
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: INVOICE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 92ee4439-a5a6-45e8-9dd7-05ad27304636
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 470e7926-54fd-47df-847b-480b51ee88b5
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(44)
        description: ""
        name: SLSPN_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 331eaae2-5c88-4be6-9ff1-58e304b303c2
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a3216592-e3f1-4542-bffd-b9b904a3abdb
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: VARCHAR(8)
        description: ""
        name: SLSPN_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2e736100-6556-4251-b0f0-5873c88127e6
                stepCounter: 387dc898-51a3-4ef1-b9d0-00005b62f115
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 22342d08-45f2-4fc1-bb35-34409560848b
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(7,4)
        description: ""
        name: COMMRATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2391a952-f1f3-4288-9c74-c0f34964d2c8
                stepCounter: a999c6b5-0f58-4e4e-a95a-a429ea2b4ee2
            transform: |-
              CASE 
                  WHEN "SLSPN_CODE" = '930'
                      AND (CASE WHEN LENGTH("FIELD_7") > 3 THEN 'Yes' ELSE 'No' END) = 'No'
                  THEN 15.0
                  ELSE COALESCE("STG_SALES_TRANSACTIONS"."COMMRATE", 0.0)
              END
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: ea7ab546-4b49-442c-bb83-91ee36278066
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38, 2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: REVENUE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN "STG_SALES_TRANSACTIONS"."UNIT" = 100
                  THEN
              ("STG_SALES_TRANSACTIONS"."QTY_SHIPPED" * "STG_SALES_TRANSACTIONS"."NET_PRICE") / 100
                  ELSE "STG_SALES_TRANSACTIONS"."QTY_SHIPPED" * "STG_SALES_TRANSACTIONS"."NET_PRICE"
              END
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 83a30de1-87d5-462d-8871-cc48ad3696ff
          stepCounter: 2d84dc99-7aec-4a21-b0b4-02b0c6bc06d4
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: TOTAL_COST
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |-
              CASE
                  WHEN "STG_SALES_TRANSACTIONS"."UNIT" = 100
                  THEN
              ("STG_SALES_TRANSACTIONS"."QTY_SHIPPED" * "STG_SALES_TRANSACTIONS"."COST") / 100
                  ELSE "STG_SALES_TRANSACTIONS"."QTY_SHIPPED" * "STG_SALES_TRANSACTIONS"."COST"
              END
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_SALES_TRANSACTIONS
        join:
          joinCondition: FROM {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_SALES_TRANSACTIONS') }} "STG_SALES_TRANSACTIONS"
        name: STG_SALES_TRANSACTIONS_WITH_CALCULATIONS
        noLinkRefs: []
  name: STG_SALES_TRANSACTIONS_WITH_CALCULATIONS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
