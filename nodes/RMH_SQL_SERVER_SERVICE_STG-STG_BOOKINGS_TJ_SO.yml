fileVersion: 1
id: c1b222bb-dded-4005-b711-c1a212cb9dc0
name: STG_BOOKINGS_TJ_SO
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: RMH_SQL_SERVER_SERVICE_STG
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 2fd2eb20-374b-46d2-8b73-e5d74e1c9971
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: VARCHAR(50)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: TRANS_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'Sales Order'"
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 29e32228-03e4-485e-93ef-18cf041cbc9a
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: YEAR("STG_ORDER"."ORDER_DATE")
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: efb1faae-e5f4-4e8f-8a19-a8ae9000824a
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: NUMBER
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: PRD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: MONTH("STG_ORDER"."ORDER_DATE")
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 25b7001f-339c-4048-8de8-e94453dc43ae
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: VARCHAR(16)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: ORDER_NO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "\"STG_ORDER\".\"JOB_NO\""
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: f96854ca-e834-4b4a-b30f-50f13a511534
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: NUMBER(38,2)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: SALE_AMT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: |+
              -SUM(
              CASE 
                  WHEN "STG_UOM"."UNIT" = '100' THEN (("STG_ORDER_LINE"."QTY_ORIG_ORD" / CAST(100 AS NUMERIC(10,2))) * "STG_ORDER_LINE"."NET_PRICE")
                  ELSE ("STG_ORDER_LINE"."QTY_ORIG_ORD" * "STG_ORDER_LINE"."NET_PRICE")
              END)

        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: cdab4988-c787-4f64-9bcb-140f4a59664b
          stepCounter: c1b222bb-dded-4005-b711-c1a212cb9dc0
        config: {}
        dataType: DATE
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: ORDER_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 458687ad-3755-4da3-ad40-8734922a4f98
                stepCounter: baf88c36-1be1-415d-9501-0d76524ba4f0
            transform: ""
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          STG_ITEM: cad668ae-9b21-4063-b9da-af244d04642b
          STG_ORDER: baf88c36-1be1-415d-9501-0d76524ba4f0
          STG_ORDER_LINE: a4a56081-3314-4f13-bd4c-cc1e834b08c9
          STG_PR_GROUP: ff14b386-d96c-4cb6-ac64-244703e4ef8e
          STG_UOM: 85deb06d-fa39-4a43-886a-872cc4b5d22d
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_ITEM
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_ORDER
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_ORDER_LINE
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_PR_GROUP
          - locationName: RMH_SQL_SERVER_SERVICE_STG
            nodeName: STG_UOM
        join:
          joinCondition: |-
            FROM {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_ORDER_LINE') }} "STG_ORDER_LINE"
            INNER JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_ORDER') }} "STG_ORDER"
            ON "STG_ORDER_LINE"."ORDER_NO" = "STG_ORDER"."ORDER_NO"
            LEFT JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_ITEM') }} "STG_ITEM"
            ON "STG_ORDER_LINE"."ITEM_NO" = "STG_ITEM"."ITEM_NO"
            LEFT JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_PR_GROUP') }} "STG_PR_GROUP"
            ON "STG_ITEM"."PROD_GROUP" = "STG_PR_GROUP"."PROD_GROUP"
            INNER JOIN {{ ref('RMH_SQL_SERVER_SERVICE_STG', 'STG_UOM') }} "STG_UOM"
            ON "STG_ORDER_LINE"."UOM_CODE" = "STG_UOM"."UOM_CODE"

            WHERE SUBSTRING("STG_ORDER"."FIELD_8",3,1) in ('-')
            GROUP BY "STG_ORDER_LINE"."ORDER_NO","STG_ORDER"."FIELD_1","STG_ORDER"."JOB_NO", "STG_ORDER"."ORDER_DATE"
        name: STG_BOOKINGS_TJ_SO
        noLinkRefs: []
  name: STG_BOOKINGS_TJ_SO
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
